# :couple: UPCO

내 주변 사람들과 자유롭게 채팅을 시작하세요.
<br>
※ 본 프로젝트는 부트캠프 팀 프로젝트입니다.
<br>
※ 배포된 사이트 https://upco.space/ 는 데모 버전 사이트입니다.
<br>
※ 현재 리팩토링, 기능 추가 중입니다.


<br>

## :star: 기획 의도

1. 기존 채팅 서비스들의 지나친 상업화.
2. 현대 사회는 여러가지 이유로 사람을 만나기가 힘듦.
위의 이유로 간단하게 채팅을 이용할 수 있는 서비스를 만들고자 했습니다.

<br>

## :sparkles: 기술 스택

|  Name  | Version |
| :----: | :-----: |
|     React     |  17.0.2  |
|      next     |  12.1.0  |
|    recoil     |   0.7.7  |
| apollo/cllien |  3.7.10  |

<br>

## :alarm_clock: 프로젝트 기간

2023.03.10 ~ 2023.04.05(정규 기간, 리팩토링 진행 중)

- Week1
  - 프로젝트 구상 및 초기 세팅
  - UI 피그마 제작 및 구상
  - UI 코딩
- Week2
  - 소켓 서버 연결
  - 소켓 이벤트별 기능 구상
  - 소켓 페이지 제작- Week3
- Week3
  - 채팅 디테일
  - 프로필, 프로필 수정 페이지 제작
- Week4
  - 서비스 배포
  - 서비스 발표 준비 및 발표

<br>

## :movie_camera: 시연 영상
채팅 기능  
<img src="https://user-images.githubusercontent.com/119839982/231172178-9892bb38-f273-44a7-87da-7d645278272c.gif" width="100%"/>

<br>

## :pushpin: 위기 및 극복 방법

백엔드와 직접 협업해서 프로젝트를 진행한 것이 처음이라 백엔드와 이벤트에 맞춰서 코드를 작성해야 하는 Socket.IO의 특성상 어려운 부분이 많았습니다. 하지만 Chat gpt를 사용하여 만들어진 여러가지 코드를 활용해 기본적인 기능부터 구현했습니다. 

<br>

서버에서 roomId가 생성되는 컴포넌트가 소켓을 연결하는 컴포넌트의 자식의 자식 컴포넌트라 Recoil 전역상태관리를 사용했습니다. 하지만 그렇게 하니 모든 roomId가 같은 값이 나오는 오류가 발생했습니다. 이를 해결하기 위해 roomId를 의존성 배열로 갖는 useEffect의 return에서 roomId를 초기화하는 로직을 넣어 각 room의 id를 다르게 설정할 수 있었습니다.

<br>

메시지를 렌더링하는 컴포넌트에서 roomId별 지난 채팅 내역인 messageLog 배열과 새로 치는 채팅인 messages 배열을 차례로 렌더링 하는 코드를 사용했는데 roomId가 변경돼도 messages가 초기화되지 않아 messageLog로 들어간 messages가 한 번 더 렌더링 되는 오류가 있었습니다. 이를 해결하기 위해 역시 roomId를 의존성 배열로 갖는 useEffect의 return에 messages를 초기화하는 로직을 넣어서 특정 roomId에 입장할 때 messageLog만 렌더링 되도록 했습니다.

<br>

채팅방에 입장할 때 지난 메시지 내역을 불러와야 하는데 messageLog 배열은 console.log에 찍히지만 유저가 메시지를 하나 발신해야 렌더링 되는 현상이 있었습니다. 이를 해결하기 위해 roomId가 바뀌면 발신 속성을 가진 "채팅방에 입장하였습니다."라는 메시지를 강제로 송출하는 로직을 추가하고 class를 따로 주고 css를 설정해 시스템 메시지처럼 보이게 했습니다.

<br>

이외에도 
1. roomId를 클라이언트에서 생성해 서버로 전송할지, 클라이언트에서 메시지 수신 유저와 발신 유저를 서버로 전송해 서버에서 roomId를 생성할지 여부.
=> 백엔드와 상의 후 클라이언트에서 수발신 유저의 id를 전송하면 uuid로 roomId를 생성해 두 유저를 join 시킴.
2. 채팅을 사용하지 않을 때는 채팅 입력 textArea가 렌더링 되지 않아야 함.
=> 연결된 roomId가 존재할 때만 채팅 입력 컴포넌트가 렌더링 되게 함.

<br>

위의 오류들을 찾아보고 해결하면서 볼륨이 작은 서비스를 개발하면서도 모든 상황을 가정하고 시도해 보면서 발생할 수 있는 모든 오류를 해결해야 한다고 느꼈습니다. 다음 프로젝트를 진행할 때는 테스트 코드를 작성해 발생할 수 있는 크고 작은 오류들을 모두 찾아내고 하나씩 해결해 완벽히 작동하는 서비스를 만들고 싶습니다.

<br>

## :books: 프로젝트 설명

로그인 후 지도에 표시되는 다른 유저와 친구 추가를 한 후에 친구 목록에서 상대 유저를 클릭하면 서버에서 roomId를 만들고 두 유저를 roomId에 join 시킨 다음 채팅을 시작합니다. 채팅방에 입장하면 roomId별로 저장된 지난 채팅 내역인 messageLog를 불러오고 로그인 된 id를 messageLog의 senderId와 비교해 수신 메시지는 왼쪽, 발신 메시지는 오른쪽에 렌더링 합니다. 

<br>

이후 "채팅방에 입장하였습니다."라는 시스템 메시지를 출력합니다. 채팅을 시작하면 발신 메시지는 isSent=true, 발신 메시지는 isSent=false로 구분해서 messages 배열에 추가되고 렌더링 됩니다. roomId가 바뀔 경우 messages 배열은 해당 roomId의 messageLog에 추가되고 초기화됩니다.

<br>

## :fire: 회고

Socket.IO에 대해 무지했지만 프로젝트를 진행하며 Socket.IO의 전반적인 부분에 대해 많이 배울 수 있었습니다. 또 새로운 기술을 배우며 프로젝트를 진행한다는 것에 대한 두려움도 사라졌습니다. 프로젝트의 초기 구상에는 webRTC를 사용해 화상 통화 기능을 구현하는 부분까지 있었지만 채팅 기능을 구현하기 위해서 잡아야 하는 디테일이 생각보다 많아서 그 부분까지 진행하지는 못했습니다. 채팅 기능 구현에 많은 시간을 투자했지만 기대만큼 안정적이고 완벽하게 디테일을 잡지 못해 아쉬움이 남는 프로젝트였습니다.

<br>

UPCO 프로젝트를 진행하면서 느낀 점은 백엔드와 소통의 중요성입니다. 투자를 받는 실제 서비스가 아니라 개인들이 뭉쳐서 만든 팀 프로젝트다 보니 운용할 수 있는 서버 성능의 한계도 느꼈고 더 완벽히 구축된 백엔드 환경에서 작업했으면 어땠을까 하는 생각도 들었습니다. 모든 멤버가 로컬 환경이 아닌 도메인을 만들고 직접 서버와 클라이언트로 연결해서 작업하는 게 처음이다 보니 구축도 어렵고 연결하는 과정도 어려움이 많았지만 이 프로젝트를 통해 어느 정도 백엔드와 소통하며 작업하는 법을 배울 수 있어서 뜻깊은 시간이었습니다. 또 오류를 해결하기 위해 하나하나 console.log를 찍어보며 어디서 오류가 났는지, 어떻게 해결해야 하는지 찾아보며 완성하는 과정에서 즐거움과 성취감을 느꼈고 앞으로도 더 많은 프로젝트를 경험해 보고 싶다는 생각이 들었습니다. 
>>>>>>> d7ee0af48616fdffc8200f41dc18f3ba30d74538
